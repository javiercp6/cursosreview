---
import BaseHead from "../../../components/BaseHead.astro";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import SelectionTags from "../../../components/SelectionTags.astro";
import CardCourse from "../../../components/CardCourse.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../../consts";
import Pagination from "../../../components/Pagination.astro";
import { tags } from "../../../consts";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
  const allTags = ["rojo", "azul", "tecnologia"];
  const posts = (await getCollection("courses")).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
  );
  // Para cada etiqueta, devuelve un resultado de paginate().
  // Asegúrate de pasar `{params: {tag}}` a `paginate()`
  // Así Astro sabrá qué agrupación de etiquetas usar.
  return tags.flatMap((tag) => {
    const filteredPosts = posts.filter((post) => post.data.category === tag);
    return paginate(filteredPosts, {
      params: { tag },
      pageSize: 2,
    });
  });
}
const { page } = Astro.props;
const params = Astro.params;
---

<!doctype html>
<html lang="es">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header class="dark:bg-gray-800 bg-white" />
    <main class="dark:bg-gray-950 bg-gray-200 min-h-screen">
      <section class="w-full max-w-screen-xl mx-auto px-2 md:px-4">
        <SelectionTags />
        <ul
          class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 justify-items-center py-5"
        >
          {
            page.data.map((post) => (
              <li>
                <a href={`/courses/${post.slug}`}>
                  <CardCourse {...post.data} slug={post.slug} />
                </a>
              </li>
            ))
          }
        </ul>
        <div class="flex justify-center pb-5">
          {
            page.url.prev || page.url.next ? (
              <Pagination nextUrl={page.url.next} prevUrl={page.url.prev} />
            ) : null
          }
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
